<html>
<head>
	<title>פעילות מדעי המחשב והנדסת תוכנה</title>
	<meta charset="utf-8" />
</head>
<body>
	<style>
		.controlButtons input {
			cursor: pointer;
			border:1px solid gold;
		}
		/* The Modal (background) */
		.modal {
			display: none; /* Hidden by default */
			position: fixed; /* Stay in place */
			z-index: 1; /* Sit on top */
			left: 0;
			top: 0;
			width: 100%; /* Full width */
			height: 100%; /* Full height */
			overflow: auto; /* Enable scroll if needed */
			background-color: rgb(0,0,0); /* Fallback color */
			background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

		/* Modal Content/Box */
		.modal-content {
			background-color: #fefefe;
			margin: 15% auto; /* 15% from the top and centered */
			padding: 20px;
			border: 1px solid #888;
			width: 80%; /* Could be more or less, depending on screen size */
		}

		/* The Close Button */
		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

			.close:hover,
			.close:focus {
				color: black;
				text-decoration: none;
				cursor: pointer;
			}
	</style>
	<div id="myModal1" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span class="close" title="סגור">&times;</span>
			<p style="align-content:center;"><center><img src="pkudot.png" /></center></p>
		</div>
	</div>
	<div id="myModal2" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
			<span class="close" title="סגור">&times;</span>
			<p style="align-content:center;"><center><img src="coords.png" /></center></p>
		</div>
	</div>
	<div align="center" dir="ltr">
		<table id="tblColors" cellspacing="0" cellpadding="0" border="0" style="border-spacing:0px 0px;">
			<tr>
				<td style="border:1px solid green;font-weight:bold;color:blue;" align="center" valign="top">
					<table dir="rtl" style="width:120px;">
						<tr>
							<th style="color:blue;">בבית נסו לשרטט</th>
						</tr>
						<tr><th style="padding-top:20px;">דובי</th></tr>
						<tr>
							<td align="center"><img src="dubi.png" width="100" height="100" /></td>
						</tr>
						<tr>
							<td align="center"><hr/></td>
						</tr>
						<tr><th style="padding-top:20px;">?</th></tr>
						<tr>
							<td align="center" style="border:1px dotted black;font-weight:bold;">
								שרטוט מאת התלמיד/ה<br/>
								will be continued...
							</td>
						</tr>
					</table>
				</td>
				<td valign="top">
					<div style="border:1px solid blue;">
						<div dir="rtl" style="font-style:italic;font-weight:bold;text-align:center;">
							כאן יש לכתוב את הפקודות לשרטוט צורות
							<a href="javascript:ShowModal('myModal1', this);" style="cursor:pointer;" title="לחצ/י כאן כדי להציג הסבר על הפקודות"><img src="qm.png" width="25" height="25" /></a>
						</div>
						<hr style="width:80%;" />
						<textarea id="txtArea" style="width:600px;height:200px;white-space:wrap;border:0px solid red;resize:none;background-color:#f3bcc4;" placeholder="write your code here"></textarea>
						<div id="tdColors"></div>
					</div>
					<div align="center" style="padding-top:20px;padding-bottom:20px;" class="controlButtons">
						<input type="button" id="addT" onclick="AddTInst();" value="פקודת משולש" title="הוספת פקודה לשרטוט משולש" />
						<input type="button" id="addR" onclick="AddRInst();" value="פקודת מלבן" title="הוספת פקודה לשרטוט מלבן" />
						<input type="button" id="addC" onclick="AddCInst();" value="פקודת עיגול" title="הוספת פקודה לשרטוט עיגול" />
						<input type="button" id="clearButton" onclick="drawObject.clearRect(0, 0, canvas.width, canvas.height);" value="נקה קנבס" title="מחיקת הצורות המשורטטות במסגרת האדומה" />
						<input type="button" id="clearCode" onclick="ClearCode();" value="מחיקת קוד" title="הקוד במסגרת הכחולה ימחק" />
						<input type="button" id="testButton" onclick="TestScript();" value="הרץ קוד" title="הפקודות המופיעות במסגרת הכחולה יתורגמו לצורות במסגרת האדומה" />
					</div>
					<div style="border:1px solid red;align-self:baseline;">
						<div dir="rtl" style="font-style:italic;font-weight:bold;text-align:center;">
							כאן ישורטטו הצורות לאחר לחיצה על כפתור "הרץ קוד"
							<a href="javascript:ShowModal('myModal2', this);" style="cursor:pointer;" title="לחצ/י כאן כדי להציג הסבר על מידות הקנבס"><img src="qm.png" width="25" height="25" /></a>
						</div>
						<hr style="width:80%;" />
						<canvas id="canvas" width="600" height="400" style="background-color:aliceblue;"></canvas><br /><br />
					</div>
				</td>
				<td style="border:1px solid green;font-weight:bold;color:blue;" align="center" valign="top">
					<table dir="rtl" style="width:120px;">
						<tr>
							<th style="color:blue;">עכשיו נסו לשרטט</th>
						</tr>
						<tr><th style="padding-top:20px;">רמזור</th></tr>
						<tr>
							<td align="center"><img src="traffic_light_2.png" width="60" height="180" /></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td colspan="3" align="center" style="font-weight:bold;font-style:italic;border:1px solid purple;">

					הלומדה נכתבה על ידי אמיר חנדלי &copy; כל הזכויות שמורות
				</td>
			</tr>
		</table>
	</div>
</body>
</html>
<script language="javascript">
    var txtarea = document.getElementById("txtArea");
    var canvas = document.getElementById("canvas");
    var addC = document.getElementById("addC");
    var addR = document.getElementById("addR");
    var addT = document.getElementById("addT");
    var drawObject = canvas.getContext('2d');
    var cwidth = canvas.width;
	var cheight = canvas.height;
	var selectedColor = -1;
	var prevS = null;
	var c1 = 0;
	var colors = ["red", "green", "blue", "brown", "white", "black", "yellow", "orange", "pink", "purple", "gray"];

	Init();

	function Init()
	{
        if (txtarea.addEventListener) {
            txtarea.addEventListener('keydown', this.keyHandler, false);
        }
        window.onclick += function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
		AddColors();
		AddCInst();
		AddRInst();
		AddTInst();
    }

	function rand(x, y)
	{
		return Math.floor(Math.random() * y) + x;
	}

	function GetShapeColor()
	{
        var ci = selectedColor >= 0 ? selectedColor : rand(0, colors.length - 1);
        return "\"" + colors[ci] + "\"";

    }

	function AddCInst()
	{
		var c = GetShapeColor();
		var r = rand(20, 80);
		var r2 = r * 2;
        var x = rand(r, cwidth - r2);
        var y = rand(r, cheight - r2);
		var command = `DrawCircle(${x}, ${y}, ${r}, ${c});`;

        txtarea.value += "\n" + command;
    }

    function AddRInst() {
        var c = GetShapeColor();
        var w = rand(50, 200);
        var h = rand(50, 200);
        var x = rand(0, cwidth - w);
        var y = rand(0, cheight - h);
        var command = `DrawRectangle(${x}, ${y}, ${w}, ${h}, ${c});`;
        txtarea.value += "\n" + command;
    }

    function AddTInst() {
        var c = GetShapeColor();
        var h = rand(50, 80);
        var a = rand(0, 360);
        var x = rand(0, cwidth - h);
        var y = rand(0, cheight - h);
        var command = `DrawTriangle(${x}, ${y}, ${h}, ${a}, ${c});`;
        txtarea.value += "\n" + command;
    }

	function AddColors()
	{
        var td = document.getElementById("tdColors");
		c1 = cwidth / colors.length;
		c1 -= 4; 

		for (var i = 0; i < colors.length; i++) {
			var s = document.createElement("span");
			s.style.display = "inline-block";
			s.style.width = c1 + "px";
			s.innerHTML = "&nbsp;";
			s.style.backgroundColor = colors[i];
            s.style.border = "2px solid " + colors[i];
			s.style.cursor = "pointer";
			s.title = colors[i];
			s.setAttribute("ci", i);
			s.setAttribute("onclick", "SelectColor(this);");
			s.setAttribute("clicked", "0");
			td.appendChild(s);
        }
	}

	function SelectColor(s)
	{
		if (s.getAttribute("clicked") == "0")
		{
			if (prevS != null)
			{
                prevS.style.borderColor = prevS.title;
                prevS.setAttribute("clicked", "0");
			}
			prevS = s;
			s.setAttribute("clicked", "1");
			s.style.borderColor = "gold";
            s.style.borderSpacing = "0px 0px 0px 0px";
			selectedColor = parseInt(s.getAttribute("ci"));
			highlightBtn(addC);
			highlightBtn(addR);
			highlightBtn(addT);
		}
		else
		{
			prevS = null;
			s.style.borderColor = s.title;
            s.setAttribute("clicked", "0");
            selectedColor = -1
			unselectBtn(addC);
			unselectBtn(addR);
			unselectBtn(addT);
        }

    }

	function highlightBtn(btn)
	{
		btn.style.border = "1px solid " + colors[selectedColor];
		btn.style.color = colors[selectedColor];
	}
	
	function unselectBtn(btn)
	{
		btn.style.border = "";
		btn.style.color = "";
	}

    function keyHandler(e) {
        var TABKEY = 9;
        if (e.keyCode == TABKEY) {
            this.value += "    ";
            if (e.preventDefault) {
                e.preventDefault();
            }
            return false;
        }
    }

	function TestScript()
    {
        eval(txtarea.value);
    }

    function DrawCircle(x, y, radius, color) {
        drawObject.beginPath();									
        drawObject.fillStyle = color;           				
        drawObject.arc(x, y, radius, 0, 2 * Math.PI);   		
        drawObject.fill();										
        drawObject.closePath();									
	}

    function DrawRectangle(x, y, width, height, color)
    {
        drawObject.beginPath();									
        drawObject.fillStyle = color;           			
        drawObject.rect(x, y, width, height);
        drawObject.fill();										
        drawObject.closePath();									
    }

    function DrawTriangle(x, y, height, angle, color)
    {
		var mid = height;
        drawObject.beginPath();									
        drawObject.fillStyle = color;
		
		angle = (180 - angle) / 180;
		drawObject.moveTo(x + height * Math.sin(angle * Math.PI), y + height * Math.cos(angle * Math.PI));
		drawObject.lineTo(x + height * Math.sin((angle + 1.5) * Math.PI), y + height * Math.cos((angle + 1.5) * Math.PI));
		drawObject.lineTo(x + height * Math.sin((angle + 0.5) * Math.PI), y + height * Math.cos((angle + 0.5) * Math.PI));
        drawObject.fill();										
        drawObject.closePath();									
    }

	function ShowModal(modalId, btn)
	{
        var modal = document.getElementById(modalId);
        modal.style.display = "block";
		var spans = document.getElementsByClassName("close");
		for (var i = 0; i < spans.length; i++)
		spans[i].onclick = function () {
            modal.style.display = "none";
        }

        }

	function ClearCode() {
		var msg = "לחיצה על אישור תגרום למחיקת כל הקוד והוא יאבד לצמיתות.";
		msg += "\n";
        msg += "יש ללחוץ על ביטול אם התחרטת.";

		if (confirm(msg))
		{
			txtarea.innerHTML = "";
			txtarea.value = "";
        }			
    }

</script>